<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
  <title>ğŸ’£ ì™€ì´ì–´ ì»· ë””í“¨ì¦ˆ</title>
  <style>
    :root{ --r:16px; }
    body{ margin:0; background:#0b0f14; color:#e9eef6; font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans KR",sans-serif; }
    .wrap{ max-width:980px; margin:0 auto; padding:14px; }
    .card{ background:#111826; border:1px solid #223049; border-radius:var(--r); padding:12px; box-shadow:0 8px 22px rgba(0,0,0,.35); }
    h1{ font-size:18px; margin:0 0 8px; }
    .muted{ color:#a9b6cc; font-size:13px; line-height:1.35; }
    .row{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin-top:8px; }
    textarea,select,button{ border:1px solid #2a3a57; background:#0e1522; color:#e9eef6; border-radius:12px; padding:10px 12px; font-size:14px; outline:none; }
    textarea{ width:100%; min-height:86px; resize:vertical; }
    button{ cursor:pointer; background:#1a2a46; }
    button.primary{ background:#2d5bff; border-color:#2d5bff; }
    button.danger{ background:#ff3b3b; border-color:#ff3b3b; color:#fff; }
    button:disabled{ opacity:.55; cursor:not-allowed; }
    .pill{ display:inline-flex; gap:8px; align-items:center; border:1px solid #2a3a57; padding:8px 10px; border-radius:999px; background:#0e1522; }
    .sep{ height:1px; background:#223049; margin:10px 0; }
    .center{ text-align:center; }
    .big{ font-size:28px; font-weight:900; letter-spacing:.4px; }
    .timer{ font-size:44px; font-weight:900; letter-spacing:1px; }
    .panel{ background:#0e1522; border:1px solid #223049; border-radius:14px; padding:12px; }
    .wires{ display:grid; grid-template-columns:1fr; gap:10px; margin-top:10px; }
    @media (min-width:720px){ .wires{ grid-template-columns:1fr 1fr; } }
    .wireBtn{
      display:flex; justify-content:space-between; align-items:center;
      padding:14px 14px; border-radius:14px; border:1px solid #2a3a57;
      background:#0b1220; font-weight:800;
      user-select:none;
    }
    .wireBtn:hover{ border-color:#4f7cff; }
    .wireCut{ opacity:.55; text-decoration:line-through; }
    .flash{ animation: flash 0.15s linear 0s 6; }
    @keyframes flash { 0%{filter:brightness(1);} 50%{filter:brightness(1.8);} 100%{filter:brightness(1);} }
    .shake{ animation: shake 0.12s linear 0s 10; }
    @keyframes shake{
      0%{transform:translateX(0)} 25%{transform:translateX(-4px)} 50%{transform:translateX(4px)} 75%{transform:translateX(-3px)} 100%{transform:translateX(0)}
    }
    .log{ font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size:12px; color:#cfe3ff; white-space:pre-wrap; }
  </style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>ğŸ’£ ì™€ì´ì–´ ì»· ë””í“¨ì¦ˆ (ì»¤í”¼ë‚´ê¸°ìš©)</h1>
    <div class="muted">
      í•œ í°ìœ¼ë¡œ ëŒë ¤ê°€ë©°: <b>í˜„ì¬ ì°¨ë¡€</b> ì‚¬ëŒì´ ì™€ì´ì–´ í•˜ë‚˜ë¥¼ â€œìë¥´ê¸°â€.<br/>
      ìš´ë¹¨ 100%ì§€ë§Œ ì¹´ìš´íŠ¸ë‹¤ìš´+í˜ì´í¬ë¡œ ë°•ì§„ê° ìˆìŒ. (ë£°ë ›ë³´ë‹¤ í›¨ì”¬ ì«„ë¦¼)
    </div>

    <div class="row">
      <textarea id="names" placeholder="ì´ë¦„ì„ ì¤„ë°”ê¿ˆìœ¼ë¡œ ì…ë ¥ (ìµœëŒ€ 10ëª…)
ì˜ˆ:
ì² ìˆ˜
ì˜í¬
ë¯¼ìˆ˜"></textarea>
    </div>

    <div class="row">
      <span class="pill">ì™€ì´ì–´ ê°œìˆ˜
        <select id="wireCount">
          <option value="6" selected>6ê°œ (ì¶”ì²œ)</option>
          <option value="8">8ê°œ</option>
          <option value="10">10ê°œ</option>
        </select>
      </span>
      <span class="pill">íƒ€ì´ë¨¸(ì´ˆ)
        <select id="timerRange">
          <option value="12-22" selected>12~22</option>
          <option value="15-30">15~30</option>
          <option value="20-40">20~40</option>
        </select>
      </span>
      <span class="pill">í˜ì´í¬ ì´ë²¤íŠ¸
        <select id="fakeLevel">
          <option value="low">ë‚®ìŒ</option>
          <option value="mid" selected>ë³´í†µ</option>
          <option value="high">ë†’ìŒ</option>
        </select>
      </span>
    </div>

    <div class="row">
      <button class="primary" id="startBtn">ê²Œì„ ì‹œì‘</button>
      <button id="nextRoundBtn" disabled>ë‹¤ìŒ ë¼ìš´ë“œ</button>
      <button class="danger" id="resetBtn">ë¦¬ì…‹</button>
      <span class="muted" id="msg"></span>
    </div>

    <div class="sep"></div>

    <div class="panel center" id="hud" style="display:none">
      <div class="muted">í˜„ì¬ ì°¨ë¡€</div>
      <div class="big" id="turnName">-</div>
      <div class="sep"></div>
      <div class="muted">ë‚¨ì€ ì‹œê°„</div>
      <div class="timer" id="timeLeft">--</div>
      <div class="muted" id="statusText" style="margin-top:6px">ì™€ì´ì–´ë¥¼ í•˜ë‚˜ ìë¥´ì„¸ìš”.</div>
    </div>

    <div class="wires" id="wires" style="display:none"></div>

    <div class="sep"></div>
    <div class="panel">
      <div class="muted">ì§„í–‰ ë¡œê·¸</div>
      <div class="log" id="log">-</div>
    </div>
  </div>
</div>

<script>
window.addEventListener("DOMContentLoaded", () => {
  const $ = (id)=>document.getElementById(id);

  // ì—ëŸ¬ë¥¼ í™”ë©´ì— í‘œì‹œ
  window.onerror = (m, s, line, col) => {
    $("msg").textContent = `JS ì˜¤ë¥˜: ${m} (line ${line}:${col})`;
  };

  function setMsg(t=""){ $("msg").textContent = t; }
  function setLog(t){ $("log").textContent = t; }
  function addLog(line){
    const cur = $("log").textContent;
    $("log").textContent = (cur === "-" ? "" : cur) + line + "\n";
  }

  function rand01(){
    const u = new Uint32Array(1);
    crypto.getRandomValues(u);
    return u[0] / 0xFFFFFFFF;
  }
  function randInt(min, maxInc){
    return min + Math.floor(rand01() * (maxInc - min + 1));
  }
  function shuffle(arr){
    for(let i=arr.length-1;i>0;i--){
      const j = randInt(0,i);
      [arr[i],arr[j]]=[arr[j],arr[i]];
    }
    return arr;
  }

  let names = [];
  let turn = 0;
  let running = false;
  let ended = false;
  let timer = null;
  let timeLeft = 0;

  // wires state
  // outcome types: "BOOM"(ì¦‰ì‚¬), "DEFUSE"(í•´ì²´), "SAFE"(ê·¸ëƒ¥ ë„˜ì–´ê°)
  let wireOutcomes = [];
  let wireCut = [];

  function parseNames(){
    const raw = $("names").value.split("\n").map(s=>s.trim()).filter(Boolean);
    const seen = new Set();
    const out = [];
    for(const n of raw){
      if(!seen.has(n)){ seen.add(n); out.push(n); }
    }
    return out.slice(0,10);
  }

  function updateTurnUI(){
    $("turnName").textContent = names[turn] ?? "-";
  }

  function stopTimer(){
    if(timer){ clearInterval(timer); timer = null; }
  }

  function endGame(reason, loserName){
    ended = true;
    running = false;
    stopTimer();
    $("nextRoundBtn").disabled = false;

    const hud = $("hud");
    hud.classList.add("flash","shake");
    setTimeout(()=>hud.classList.remove("flash","shake"), 1200);

    if(reason === "boom"){
      $("statusText").textContent = `ğŸ’¥ í­ë°œ! ${loserName} íŒ¨ë°°`;
      addLog(`ğŸ’¥ í­ë°œ! íŒ¨ë°°: ${loserName}`);
      alert(`ğŸ’¥ í­ë°œ!\níŒ¨ë°°: ${loserName}\n\nì»¤í”¼ ì˜ê¸° ã„±ã„±`);
    } else if(reason === "timeout"){
      $("statusText").textContent = `â± íƒ€ì„ì•„ì›ƒ! ${loserName} íŒ¨ë°°`;
      addLog(`â± íƒ€ì„ì•„ì›ƒ íŒ¨ë°°: ${loserName}`);
      alert(`â± íƒ€ì„ì•„ì›ƒ!\níŒ¨ë°°: ${loserName}\n\nì»¤í”¼ ì˜ê¸° ã„±ã„±`);
    } else if(reason === "defuse"){
      $("statusText").textContent = `ğŸ§° í•´ì²´ ì„±ê³µ! (${loserName}ê°€ ì‚´ë¦¼)`;
      addLog(`ğŸ§° í•´ì²´ ì„±ê³µ! ë§ˆì§€ë§‰ ì»·: ${loserName}`);
      alert(`ğŸ§° í•´ì²´ ì„±ê³µ!\në§ˆì§€ë§‰ìœ¼ë¡œ ìë¥¸ ì‚¬ëŒ: ${loserName}\n\nì´ë²ˆ ë¼ìš´ë“œëŠ” ë¬´íš¨ë¡œ í• ì§€, ë‹¹ì²¨ìœ¼ë¡œ í• ì§€ ë£° ì •í•´ë„ ë¨`);
    }

    // disable wire buttons
    [...$("wires").querySelectorAll("button")].forEach(b=>b.disabled = true);
  }

  function maybeFakeEvent(){
    const lvl = $("fakeLevel").value;
    const p = (lvl==="high") ? 0.22 : (lvl==="mid") ? 0.14 : 0.08;
    if(rand01() > p) return;

    const hud = $("hud");
    hud.classList.add("flash");
    $("statusText").textContent = "âš  ê²½ê³ ìŒâ€¦ (í˜ì´í¬)";
    setTimeout(()=>{
      hud.classList.remove("flash");
      if(!ended) $("statusText").textContent = "ì™€ì´ì–´ë¥¼ í•˜ë‚˜ ìë¥´ì„¸ìš”.";
    }, 650);
  }

  function startTimer(){
    const [a,b] = $("timerRange").value.split("-").map(Number);
    timeLeft = randInt(a,b);
    $("timeLeft").textContent = timeLeft;

    stopTimer();
    timer = setInterval(()=>{
      if(ended) return;
      timeLeft--;
      $("timeLeft").textContent = timeLeft;

      // í˜ì´í¬ ì´ë²¤íŠ¸
      if(timeLeft % 3 === 0) maybeFakeEvent();

      if(timeLeft <= 0){
        endGame("timeout", names[turn] ?? "ëˆ„êµ°ê°€");
      }
    }, 1000);
  }

  function nextTurn(){
    if(ended) return;
    turn = (turn + 1) % names.length;
    updateTurnUI();
  }

  function buildWires(){
    const n = Number($("wireCount").value);

    // outcomes: 1 boom, 1 defuse, rest safe
    wireOutcomes = Array(n).fill("SAFE");
    wireOutcomes[0] = "BOOM";
    wireOutcomes[1] = "DEFUSE";
    shuffle(wireOutcomes);

    wireCut = Array(n).fill(false);

    const container = $("wires");
    container.innerHTML = "";
    const colors = ["RED","BLUE","GREEN","YELLOW","PURPLE","ORANGE","WHITE","BLACK","CYAN","PINK"];

    for(let i=0;i<n;i++){
      const btn = document.createElement("button");
      btn.className = "wireBtn";
      btn.type = "button";
      btn.innerHTML = `<span>ğŸ”Œ WIRE ${i+1}</span><span class="muted">${colors[i % colors.length]}</span>`;
      btn.addEventListener("click", () => cutWire(i, btn));
      container.appendChild(btn);
    }
  }

  function cutWire(i, btn){
    if(ended) return;
    if(wireCut[i]) return;

    wireCut[i] = true;
    btn.classList.add("wireCut");
    btn.disabled = true;

    const actor = names[turn] ?? "ëˆ„êµ°ê°€";
    addLog(`- ${actor} : WIRE ${i+1} ì»·`);

    // ì‘ì€ ì—°ì¶œ
    $("hud").classList.add("flash");
    setTimeout(()=>$("hud").classList.remove("flash"), 250);

    const out = wireOutcomes[i];
    if(out === "BOOM"){
      endGame("boom", actor);
      return;
    }
    if(out === "DEFUSE"){
      endGame("defuse", actor);
      return;
    }

    // safe
    $("statusText").textContent = "âœ… ì„¸ì´í”„â€¦ ë‹¤ìŒ ì‚¬ëŒ!";
    setTimeout(()=>{
      if(!ended){
        $("statusText").textContent = "ì™€ì´ì–´ë¥¼ í•˜ë‚˜ ìë¥´ì„¸ìš”.";
        nextTurn();
      }
    }, 450);
  }

  function startGame(){
    names = parseNames();
    if(names.length < 3){
      setMsg("ìµœì†Œ 3ëª…ë¶€í„° ê°€ëŠ¥!");
      return;
    }
    setMsg("");
    setLog("-");
    turn = randInt(0, names.length-1);
    ended = false;
    running = true;

    $("hud").style.display = "block";
    $("wires").style.display = "grid";
    $("nextRoundBtn").disabled = true;

    updateTurnUI();
    buildWires();
    $("statusText").textContent = "ì™€ì´ì–´ë¥¼ í•˜ë‚˜ ìë¥´ì„¸ìš”.";
    addLog(`ğŸ¬ ì‹œì‘! (ì²« í„´: ${names[turn]})`);

    startTimer();
  }

  function nextRound(){
    if(!names.length) return;
    ended = false;
    running = true;

    $("nextRoundBtn").disabled = true;
    updateTurnUI();
    buildWires();
    $("statusText").textContent = "ì™€ì´ì–´ë¥¼ í•˜ë‚˜ ìë¥´ì„¸ìš”.";
    addLog(`\nğŸ” ë‹¤ìŒ ë¼ìš´ë“œ ì‹œì‘! (ì²« í„´: ${names[turn]})`);

    startTimer();
    [...$("wires").querySelectorAll("button")].forEach(b=>b.disabled = false);
  }

  function resetAll(){
    stopTimer();
    names = [];
    turn = 0;
    ended = false;
    running = false;
    $("hud").style.display = "none";
    $("wires").style.display = "none";
    $("nextRoundBtn").disabled = true;
    setMsg("");
    setLog("-");
    $("timeLeft").textContent = "--";
    $("turnName").textContent = "-";
    $("statusText").textContent = "";
  }

  $("startBtn").addEventListener("click", startGame);
  $("nextRoundBtn").addEventListener("click", nextRound);
  $("resetBtn").addEventListener("click", resetAll);

});
</script>
</body>
</html>
