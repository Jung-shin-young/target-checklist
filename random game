<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ğŸ’£ ë¯¸ìŠ¤í„°ë¦¬ íƒ€ì´ë¨¸ ë°•ìŠ¤</title>
  <style>
    :root { --r: 16px; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", sans-serif; margin: 0; background:#0b0f14; color:#e9eef6;}
    .wrap{ max-width: 980px; margin: 0 auto; padding: 18px; }
    .card{ background:#111826; border:1px solid #223049; border-radius: var(--r); padding: 14px; box-shadow: 0 8px 22px rgba(0,0,0,.35); }
    h1{ font-size: 20px; margin: 0 0 10px; }
    h2{ font-size: 16px; margin: 12px 0 8px; color:#cfe3ff; }
    .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    input, select, button, textarea{
      border:1px solid #2a3a57; background:#0e1522; color:#e9eef6;
      border-radius: 12px; padding: 10px 12px; font-size: 14px;
      outline: none;
    }
    input:focus, textarea:focus, select:focus{ border-color:#4f7cff; box-shadow: 0 0 0 3px rgba(79,124,255,.18); }
    button{ cursor:pointer; background:#1a2a46; }
    button.primary{ background:#2d5bff; border-color:#2d5bff; }
    button.danger{ background:#ff3b3b; border-color:#ff3b3b; color:#fff; }
    button:disabled{ opacity:.5; cursor:not-allowed; }
    .muted{ color:#a9b6cc; font-size: 13px; }
    .pill{ display:inline-flex; gap:8px; align-items:center; border:1px solid #2a3a57; padding:8px 10px; border-radius:999px; background:#0e1522; }
    .grid{ display:grid; grid-template-columns: 1fr; gap:12px; }
    @media (min-width:820px){ .grid{ grid-template-columns: 1.2fr .8fr; } }
    .big{ font-size: 42px; font-weight: 800; letter-spacing: .5px; }
    .center{ text-align:center; }
    .sep{ height:1px; background:#223049; margin: 12px 0; }
    .list{ display:flex; flex-direction:column; gap:8px; }
    .playerLine{ display:flex; justify-content:space-between; gap:10px; align-items:center; padding:10px 12px; border:1px solid #223049; border-radius:12px; background:#0e1522;}
    .tag{ font-size:12px; padding:4px 8px; border-radius:999px; border:1px solid #2a3a57; color:#cfe3ff; }
    .kbd{ font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size: 12px; padding:2px 6px; border-radius:6px; border:1px solid #2a3a57; background:#0e1522; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>ğŸ’£ ë¯¸ìŠ¤í„°ë¦¬ íƒ€ì´ë¨¸ ë°•ìŠ¤ (ìš´ë¹¨+ì‹¬ë¦¬, ì‹¤ë ¥ 0ì— ê°€ê¹ê²Œ)</h1>
      <div class="muted">
        í•œ í°/í•œ í™”ë©´ìœ¼ë¡œ ëŒë¦´ ë•Œ: <span class="kbd">ë‚´ ì°¨ë¡€</span>ì—ë§Œ ì¹´ë“œ í™•ì¸ â†’ í–‰ë™ ì„ íƒ â†’ ë°”ë¡œ ìˆ¨ê¹€ â†’ ë‹¤ìŒ ì‚¬ëŒì—ê²Œ í° ë„˜ê¸°ê¸°.
      </div>
    </div>

    <div style="height:12px"></div>

    <div class="grid">
      <!-- Setup -->
      <div class="card" id="setupCard">
        <h2>1) ì°¸ê°€ì ì„¤ì • (ìµœëŒ€ 10ëª…)</h2>
        <div class="row">
          <textarea id="names" rows="6" style="width:100%" placeholder="ì´ë¦„ì„ ì¤„ë°”ê¿ˆìœ¼ë¡œ ì…ë ¥ (ì˜ˆ: ì‹ ì˜&#10;ì™€ì´í”„&#10;ì² ìˆ˜&#10;ì˜í¬)"></textarea>
        </div>
        <div class="row" style="margin-top:10px">
          <div class="pill">
            ğŸ’£ í­íƒ„ ê°œìˆ˜
            <select id="bombCount">
              <option value="1">1ê°œ (ê¸°ë³¸)</option>
              <option value="2">2ê°œ (ë” ì‚´ë²Œ)</option>
              <option value="3">3ê°œ (ì§€ì˜¥)</option>
            </select>
          </div>
          <div class="pill">
            â± íƒ€ì´ë¨¸ ë²”ìœ„(ì´ˆ)
            <select id="timerRange">
              <option value="8-18">8~18</option>
              <option value="10-25" selected>10~25</option>
              <option value="15-35">15~35</option>
            </select>
          </div>
          <div class="pill">
            ğŸ¯ ì¤‘ì•™ë± êµí™˜
            <select id="deckSwapMode">
              <option value="on" selected>ê°€ëŠ¥</option>
              <option value="off">ë¶ˆê°€</option>
            </select>
          </div>
        </div>

        <div class="row" style="margin-top:12px">
          <button class="primary" id="startBtn">ë¼ìš´ë“œ ì‹œì‘</button>
          <button id="resetBtn">ì´ˆê¸°í™”</button>
          <span class="muted" id="setupMsg"></span>
        </div>

        <div class="sep"></div>
        <div class="muted">
          ì¶”ì²œ ë‚´ê¸° ë£°: <b>íƒˆë½ì = ë²Œì¹™</b> or <b>1,000ì›</b> / ë¼ìš´ë“œ.  
          ë¼ìš´ë“œê°€ ë¹¨ë¦¬ ëë‚˜ë©´ í­íƒ„ ê°œìˆ˜ ì˜¬ë¦¬ë©´ ë¨.
        </div>
      </div>

      <!-- Game -->
      <div class="card" id="gameCard" style="display:none">
        <h2>2) ì§„í–‰</h2>
        <div class="row" style="justify-content:space-between">
          <div class="pill">ë¼ìš´ë“œ <b id="roundNo">1</b></div>
          <div class="pill">ë‚¨ì€ì‹œê°„ <b id="timeLeft">--</b>ì´ˆ</div>
        </div>

        <div class="sep"></div>

        <div class="center">
          <div class="muted">í˜„ì¬ ì°¨ë¡€</div>
          <div class="big" id="currentPlayer">-</div>
          <div class="muted" id="turnHint">í°ì„ í•´ë‹¹ ì‚¬ëŒì—ê²Œ ë„˜ê¸°ê³  ì§„í–‰í•˜ì„¸ìš”.</div>
        </div>

        <div class="sep"></div>

        <div class="center">
          <button id="revealBtn">ë‚´ ì¹´ë“œ í™•ì¸</button>
          <div style="height:10px"></div>
          <div class="pill" id="cardBox" style="display:none; justify-content:center; font-size:18px;">
            ë‚´ ì¹´ë“œ: <b id="myCard">?</b>
          </div>
        </div>

        <div class="sep"></div>

        <h2>í–‰ë™ ì„ íƒ</h2>
        <div class="row">
          <button id="keepBtn">ìœ ì§€</button>
          <button id="swapLeftBtn">ì™¼ìª½ê³¼ êµí™˜</button>
          <button id="swapRightBtn">ì˜¤ë¥¸ìª½ê³¼ êµí™˜</button>
          <button id="swapDeckBtn">ì¤‘ì•™ë±ê³¼ êµí™˜</button>
        </div>
        <div class="muted" style="margin-top:8px">
          * êµí™˜ì€ ì‹¤ì œë¡œ ì¹´ë“œê°€ ë°”ë€ë‹ˆë‹¤. (ì„ íƒ í›„ ìë™ìœ¼ë¡œ ë‹¤ìŒ ì‚¬ëŒ í„´)
        </div>

        <div class="sep"></div>

        <div class="row">
          <button class="danger" id="forceEndBtn">ì¦‰ì‹œ ì¢…ë£Œ(í­íƒ„ ê³µê°œ)</button>
          <span class="muted" id="gameMsg"></span>
        </div>
      </div>
    </div>

    <div style="height:12px"></div>

    <div class="card" id="statusCard" style="display:none">
      <h2>ìƒíƒœ (ê³µê°œ ê¸ˆì§€: ìš´ì˜ì/ì§„í–‰ìš©)</h2>
      <div class="muted">ì•„ë˜ëŠ” ë””ë²„ê·¸/ì§„í–‰ ë„ì›€ìš©. ê²Œì„ ì¤‘ì—” ë³´ì§€ ë§ˆì„¸ìš” ğŸ˜‚</div>
      <div style="height:10px"></div>
      <div class="list" id="playersList"></div>
    </div>
  </div>

<script>
  // --- secure-ish random helpers
  function randInt(min, maxInclusive){
    const range = maxInclusive - min + 1;
    const buf = new Uint32Array(1);
    crypto.getRandomValues(buf);
    return min + (buf[0] % range);
  }
  function shuffle(arr){
    for(let i=arr.length-1;i>0;i--){
      const j = randInt(0,i);
      [arr[i],arr[j]] = [arr[j],arr[i]];
    }
    return arr;
  }

  // --- state
  let state = {
    round: 1,
    names: [],
    alive: [],
    // each player holds a card: "BOMB" or "SAFE"
    cards: [],
    // deck has some safe cards, and may contain bombs depending on swaps
    deck: [],
    turnIndex: 0,
    timer: null,
    timeLeft: null,
    revealedThisTurn: false,
    deckSwapOn: true,
    ended: false
  };

  const $ = (id)=>document.getElementById(id);

  const setupCard = $("setupCard");
  const gameCard = $("gameCard");
  const statusCard = $("statusCard");

  function parseNames(){
    const raw = $("names").value.split("\n").map(s=>s.trim()).filter(Boolean);
    // unique-ish but keep order
    const seen = new Set();
    const names = [];
    for(const n of raw){
      if(!seen.has(n)){ seen.add(n); names.push(n); }
    }
    return names.slice(0,10);
  }

  function updateStatusList(){
    const list = $("playersList");
    list.innerHTML = "";
    state.alive.forEach((name, idx)=>{
      const line = document.createElement("div");
      line.className = "playerLine";
      const left = document.createElement("div");
      left.innerHTML = `<b>${name}</b> <span class="tag">${idx===state.turnIndex ? "í˜„ì¬í„´" : "ëŒ€ê¸°"}</span>`;
      const right = document.createElement("div");
      right.className = "muted";
      right.textContent = state.cards[idx]==="BOMB" ? "ğŸ’£" : "âœ…";
      line.appendChild(left);
      line.appendChild(right);
      list.appendChild(line);
    });
  }

  function setTurnUI(){
    $("currentPlayer").textContent = state.alive[state.turnIndex] ?? "-";
    $("cardBox").style.display = "none";
    $("myCard").textContent = "?";
    state.revealedThisTurn = false;

    // buttons enable/disable
    $("revealBtn").disabled = state.ended;
    $("keepBtn").disabled = state.ended;
    $("swapLeftBtn").disabled = state.ended || state.alive.length < 2;
    $("swapRightBtn").disabled = state.ended || state.alive.length < 2;
    $("swapDeckBtn").disabled = state.
